@baseUrl = http://localhost:9200
@contentType = application/json
@credentials = ZWxhc3RpYzphZG1pbjEyMw==
@indexName = hotels

### Get All Hotels with City Filter (CORRECTED - using must instead of filter for city)
POST {{baseUrl}}/{{indexName}}/_search
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

{
  "query": {
    "bool": {
      "filter": [
        { "term": { "status.keyword": "active" } },
        { "term": { "is_available": true } },
        { "term": { "has_available_rooms": true } }
      ],
      "must": [
        {
          "match": {
            "city": {
              "query": "Irving",
              "fuzziness": "AUTO",
              "operator": "and"
            }
          }
        }
      ],
      "should": []
    }
  },
  "sort": [
    { "avg_rating": { "order": "desc" } } 
  ],
  "size": 200,
  "_source": [
    "hotel_id", "hotel_name", "city", "country", "location", "latitude", "longitude",
    "min_price", "max_price", "avg_rating", "review_count", "hotel_class", "status",
    "amenity_codes", "has_free_cancellation", "primary_image_url", "total_bookings", "view_count"
  ]
}

>>! response1.json

### Search Hotels by Name (Full-text)
POST {{baseUrl}}/{{indexName}}/_search
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

{
  "size": 10,
  "query": {
    "match": {
      "city": "Irving"
    }
  },
  "highlight": {
    "fields": {
      "hotel_name": {}
    }
  }
}

>>! response2.json

### Test 3: Get all hotels without any filters (to see what's in the index)
POST {{baseUrl}}/{{indexName}}/_search
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

{
  "size": 10,
  "query": {
    "match_all": {}
  }
}

### Test 4: Check index mapping
GET {{baseUrl}}/{{indexName}}/_mapping
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

### Test 5: Count total documents
GET {{baseUrl}}/{{indexName}}/_count
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

### Test 6: Search with aggregations to see all cities
POST {{baseUrl}}/{{indexName}}/_search
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

{
  "size": 0,
  "aggs": {
    "cities": {
      "terms": {
        "field": "city.keyword",
        "size": 50
      }
    },
    "available_hotels": {
      "filter": {
        "bool": {
          "must": [
            { "term": { "status.keyword": "active" } },
            { "term": { "is_available": true } },
            { "term": { "has_available_rooms": true } }
          ]
        }
      },
      "aggs": {
        "cities_with_availability": {
          "terms": {
            "field": "city.keyword",
            "size": 50
          }
        }
      }
    }
  }
}

### Test 7: Search Irving with case variations
POST {{baseUrl}}/{{indexName}}/_search
Content-Type: {{contentType}}
Authorization: Basic {{credentials}}

{
  "size": 10,
  "query": {
    "bool": {
      "should": [
        { "match": { "city": "irving" } },
        { "match": { "city": "Irving" } },
        { "match": { "city": "IRVING" } }
      ]
    }
  }
}

